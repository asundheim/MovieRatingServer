using MovieRating.Shared;
using System.Text.Json;
using System.Text.Json.Serialization;

namespace GatherMovieInfo
{
    internal class Program
    {
        const string RawIds = "tt0063442,tt0146882,tt1905041,tt0087544,tt0082694,tt0352248,tt1302011,tt1453405,tt1124035,tt5095030,tt0083987,tt0983193,tt0431308,tt0411477,tt0027977,tt0366551,tt5848272,tt0138097,tt0138704,tt2267968,tt0040522,tt0092067,tt0455590,tt2277860,tt5109280,tt0128445,tt0462322,tt0134847,tt0029583,tt0123755,tt0362270,tt1013753,tt0120630,tt0021749,tt0241303,tt1690953,tt0307901,tt0061512,tt0308644,tt0200465,tt1077258,tt0462538,tt1515091,tt0109707,tt0109445,tt0112851,tt0272152,tt1125849,tt0832266,tt0183649,tt2080374,tt7668870,tt2334873,tt0042332,tt0481499,tt7146812,tt0092991,tt0106308,tt0120188,tt1458175,tt0333766,tt15097216,tt0079817,tt0810819,tt0479143,tt0130827,tt0427944,tt0372588,tt1655442,tt0158983,tt10811166,tt10676052,tt31036941,tt0093894,tt3110958,tt14948432,tt10545296,tt10548174,tt0170016,tt12299608,tt0457939,tt7144666,tt26584495,tt5177120,tt13654226,tt2704998,tt13560574,tt7349950,tt17351924,tt1099212,tt28015403,tt0338348,tt1684562,tt26047818,tt15791034,tt0104431,tt10016180,tt0111070,tt9218128,tt0458352,tt0322330,tt2322441,tt4263482,tt18925334,tt3566834,tt0363771,tt1790809,tt10731256,tt11389872,tt23468450,tt3359350,tt1790864,tt9619824,tt0117509,tt1623205,tt0387808,tt3829266,tt12584954,tt0307987,tt17279496,tt16426418,tt1517268,tt6166392,tt21382296,tt0790724,tt12747748,tt0163651,tt0367594,tt0110475,tt0116483,tt1483013,tt1937390,tt26753003,tt11138512,tt7740496,tt0116629,tt0265208,tt0175142,tt0092099,tt2527338,tt0112697,tt7069210,tt0381707,tt17024450,tt15671028,tt1951265,tt0463854,tt0111282,tt1446714,tt0259711,tt1298650,tt0250494,tt1424381,tt0118655,tt2316411,tt14513804,tt2379713,tt2554274,tt7798634,tt0758752,tt2404435,tt1649418,tt3104988,tt7737786,tt0183790,tt0384537,tt0315327,tt15314262,tt1922777,tt5109784,tt6718170,tt0838283,tt1723121,tt3569230,tt2283362,tt2024469,tt0816711,tt5715874,tt9639470,tt1840309,tt0120915,tt0369610,tt1478338,tt0100403,tt1386697,tt14138650,tt1650062,tt0398165,tt1564367,tt1104001,tt3402236,tt1951266,tt1355644,tt1462764,tt0364725,tt1136617,tt0970416,tt1648190,tt1245492,tt8041270,tt0120783,tt9032400,tt2798920,tt1637688,tt4649466,tt1340800,tt5164214,tt0109040,tt0251127,tt11858890,tt1386588,tt2283336,tt1291150,tt0356910,tt0101272,tt13287846,tt1441395,tt0142342,tt5433140,tt1637725,tt2527336,tt0407304,tt1067106,tt1190080,tt0209163,tt13433802,tt16366836,tt0486822,tt2333784,tt0117008,tt0139134,tt0795421,tt3766354,tt0102057,tt0978764,tt3480822,tt6450804,tt0256415,tt0106697,tt0106918,tt1502712,tt1386703,tt1663662,tt0830515,tt11315808,tt1037705,tt1041829,tt2463208,tt1259521,tt2049403,tt1259528,tt0243155,tt0302886,tt8244784,tt0232500,tt3235888,tt4123432,tt1014759,tt0452594,tt0382625,tt0167190,tt0477347,tt0120591,tt9777666,tt1645170,tt0104070,tt0120812,tt0458339,tt0389722,tt0207201,tt4046784,tt14230388,tt0120888,tt1758830,tt2935510,tt10954984,tt0399201,tt7991608,tt0368891,tt9421570,tt0120667,tt0267913,tt0360486,tt1591095,tt29268110,tt0355295,tt0160127,tt0119303,tt6857112,tt0396269,tt0286106,tt10648342,tt1375670,tt0338526,tt0120647,tt10293406,tt6856242,tt1245526,tt0195714,tt2872732,tt15474916,tt0356150,tt5439796,tt7975244,tt0380510,tt0800369,tt0870154,tt3393786,tt2660888,tt2316204,tt1411697,tt0948470,tt1469304,tt0887883,tt5814060,tt0370263,tt4513678,tt9419884,tt0319262,tt2345759,tt0096320,tt1340138,tt0374900,tt6139732,tt2737304,tt1464335,tt1320253,tt0119081,tt4178092,tt9114286,tt0099938,tt14966898,tt0247638,tt2312718,tt1587310,tt0164184,tt1673434,tt3385516,tt4500922,tt0439572,tt0213149,tt0478311,tt0837562,tt0814255,tt0121765,tt1028528,tt0108160,tt8079248,tt3778644,tt5442430,tt5433138,tt10838180,tt0430922,tt1282140,tt1488606,tt0368447,tt0128853,tt1213663,tt15789038,tt1590193,tt11245972,tt1060277,tt7846844,tt0389860,tt0091203,tt5886046,tt1013752,tt0493464,tt0320691,tt0859163,tt1935859,tt3289956,tt1259571,tt5638642,tt0337563,tt2975590,tt11291274,tt0351283,tt0185937,tt1270797,tt7556122,tt8760708,tt4881806,tt0119567,tt0145660,tt1152836,tt4123430,tt0478304,tt0343660,tt0317919,tt0870984,tt0413300,tt0102798,tt1972591,tt2873282,tt1155056,tt1231587,tt4196776,tt0212985,tt2239822,tt0955308,tt0415306,tt1611224,tt0120804,tt3631112,tt0181852,tt0246460,tt0317740,tt1228705,tt1219827,tt7657566,tt0373051,tt2788710,tt1001508,tt0082198,tt2404233,tt2294449,tt0146316,tt0418763,tt0059800,tt0117998,tt0295700,tt0371724,tt0463985,tt8228288,tt3079380,tt0120755,tt17663992,tt0119528,tt1477834,tt14998742,tt0103644,tt3748172,tt3322940,tt22687790,tt0477080,tt0196229,tt6823368,tt0454945,tt1636826,tt0448115,tt1528854,tt0800320,tt0112442,tt0116583,tt1951261,tt1365519,tt0084827,tt10954600,tt4154664,tt0401729,tt0800080,tt0118880,tt0482606,tt1325004,tt0242653,tt1187064,tt1661199,tt3371366,tt1764651,tt2557490,tt1628841,tt0089880,tt1632708,tt0429493,tt0910936,tt7959026,tt0257106,tt1706593,tt1409024,tt1489889,tt1535108,tt10954652,tt11214590,tt0974015,tt0103855,tt0295178,tt1077368,tt0119345,tt0212338,tt1007028,tt1092026,tt0831387,tt5742374,tt0187738,tt1599348,tt0305224,tt2503944,tt3794354,tt0438488,tt0293429,tt0087182,tt0478087,tt0349903,tt6443346,tt6565702,tt0120912,tt4520988,tt0120347,tt3062096,tt8936646,tt0829150,tt1019452,tt2908446,tt10676048,tt1440129,tt0118583,tt1013743,tt6394270,tt0087928,tt1600196,tt3741700,tt0413099,tt5034838,tt0163025,tt0105793,tt2709768,tt1714206,tt0120082,tt0093177,tt0993842,tt13345606,tt0367882,tt13320622,tt0107120,tt0844471,tt0450385,tt0384793,tt1700841,tt1231583,tt2381941,tt1399103,tt0397065,tt8106534,tt0758774,tt0088128,tt1436562,tt0133751,tt7713068,tt0808151,tt0339291,tt1502397,tt1068680,tt1131734,tt0499448,tt1872181,tt1055369,tt0119395,tt0080761,tt0102510,tt0337741,tt5140878,tt0116996,tt1598778,tt7097896,tt0307453,tt0112508,tt1482459,tt0143145,tt0448011,tt0330793,tt3567288,tt0107362,tt0322259,tt1216475,tt0212346,tt1601913,tt1563738,tt0433400,tt1272878,tt0230011,tt0187078,tt1086772,tt1046173,tt0114898,tt0758730,tt0427327,tt2406566,tt1389072,tt6105098,tt0286716,tt0462499,tt0473075,tt2184339,tt0120890,tt1499658,tt2302755,tt2120120,tt0421239,tt2109248,tt0988595,tt1981128,tt1385826,tt0489099,tt0163978,tt0358082,tt1618434,tt2191701,tt1538403,tt2126355,tt1964418,tt1155076,tt1615160,tt1172570,tt9893250,tt1253864,tt0454841,tt0349683,tt0106582,tt2180411,tt0097523,tt0183505,tt0120746,tt0079501,tt1100089,tt0107977,tt12263384,tt0425061,tt0088944,tt1324999,tt0177971,tt0905372,tt1148204,tt1731141,tt2388715,tt0448694,tt0472033,tt2209764,tt0120484,tt4062536,tt0993840,tt1289401,tt3606752,tt1194173,tt1464540,tt5308322,tt5022702,tt0112642,tt0458481,tt0120632,tt1355683,tt0450278,tt1262416,tt0472399,tt1905041,tt7040874,tt1560220,tt1058017,tt0408790,tt2293640,tt0366548,tt2229499,tt3731562,tt4651520,tt0266915,tt2321549,tt6806448,tt1188729,tt5095030,tt0092644,tt0397892,tt2222042,tt0120744,tt0974661,tt0120685,tt0089927,tt1959490,tt3846674,tt1536537,tt0431308,tt0944835,tt0114148,tt1054606,tt0134084,tt1142988,tt0486576,tt0448157,tt0411477,tt4779682,tt1411250,tt0215129,tt0376994,tt0164052,tt2334879,tt0475290,tt0293662,tt0227445,tt0259324,tt1583421,tt0949731,tt0366551,tt5848272,tt0274166,tt15679400,tt5108870,tt0458525,tt0253556,tt4630562,tt1078912,tt8097030,tt1981115,tt1411238,tt0413267,tt0980970,tt0385752,tt1211956,tt1267297,tt10151854,tt0363988,tt0803096,tt1860213,tt1335975,tt0306047,tt1571234,tt0479884,tt4701182,tt2004420,tt0433362,tt1206543,tt0112462,tt0346491,tt0409847,tt0496806,tt0462590,tt0290002,tt7126948,tt0348150,tt1617661,tt1389137,tt0309593,tt0145681,tt2848292,tt0161081,tt4501244,tt1430132,tt2692250,tt0465234,tt1234721,tt1243957,tt3469046,tt0117705,tt1127180,tt1284575,tt2446980,tt0258000,tt0918940,tt0112281,tt0119738,tt0134847,tt1253863,tt1502407,tt0164912,tt0263488,tt0133152,tt0227538,tt1588173,tt0120681,tt1059786,tt1979388,tt0118571,tt1288558,tt0327084,tt1980209,tt0182789,tt1077258,tt2404463,tt0480687,tt2231461,tt0120657,tt0172156,tt1606389,tt0296572,tt0404032,tt0414982,tt2024432,tt3410834,tt0142688,tt0324216,tt0471042,tt4786282,tt13143964,tt0362120,tt0892791,tt0386588,tt2637276,tt1401152,tt2094766,tt1764234,tt0815236,tt0122933,tt0435705,tt0252866,tt0359013,tt1279935,tt5884052,tt0430105,tt0096928,tt1735898,tt1915581,tt0149261,tt4566758,tt1390411,tt1606378,tt1258197,tt1650554,tt0268695,tt2234155,tt2101441,tt0963966,tt2975578,tt0251075,tt0117438,tt1821694,tt0465494,tt2567026,tt1210819,tt0256380,tt0097428,tt0311429,tt0328880,tt2203939,tt2510894,tt0475394,tt0397101,tt0410297,tt0313737,tt0259446,tt1528100,tt0452608,tt0120891,tt0293564,tt0113855,tt10298810,tt1488555,tt1616195,tt0431197,tt1144884,tt1549920,tt1622979,tt0432348,tt2023587,tt0365737,tt0481369,tt0095956,tt0985694,tt0329101,tt1135503,tt0184894,tt2034800,tt0104714,tt0325703,tt2854926,tt0134273,tt0295701,tt2369135,tt0762107,tt0327850,tt1448755,tt1351685,tt0317198,tt0084602,tt0385880,tt0892782,tt0335438,tt1823672,tt0449010,tt0114069,tt0318627,tt3531824,tt1091722,tt0146838,tt1428538,tt1959563,tt0265459,tt0479952,tt0424095,tt0277296,tt0280590,tt0822832,tt1596365,tt0442933,tt0122151,tt1904996,tt1854564,tt0369441,tt0389790,tt0453451,tt2561572,tt0216216,tt0373883,tt0842926,tt0401855,tt0305357,tt1596350,tt3874544,tt2557478,tt1111422,tt0424136,tt0960144,tt0261392,tt0365907,tt1646987,tt0391198,tt0112431,tt0244244,tt4034354,tt0190138,tt1055292,tt2096672,tt1605630,tt1321870,tt1038919,tt2226417,tt1462758,tt0089530,tt0388482,tt1790886,tt1939659,tt0292506,tt1080016,tt1634122,tt0115798,tt0257076,tt1397280,tt0100507,tt0834001,tt1924435,tt0113492,tt1179904,tt0287978,tt1033643,tt0432021,tt0455824,tt2446042,tt2170439,tt1277953,tt1205537,tt0455407,tt0113749,tt0438097,tt1667889,tt1133985,tt0489270,tt0314353,tt3300542,tt0445934,tt1121931,tt4052882,tt2177771,tt1911644,tt0120587,tt1217613,tt0947810,tt0417148,tt1226229,tt0889583,tt1229340,tt5758778,tt0989757,tt3152624,tt1234548,tt0343135,tt4776998,tt0285823,tt1071875,tt1615065,tt0328828,tt0451079,tt5519340,tt1314655,tt1855325,tt0790736,tt0465602,tt1129442,tt1034032,tt1355630,tt1220634,tt0986263,tt0443649,tt1496025,tt0443274,tt0890870,tt0402022,tt0242423,tt1298649,tt0467197,tt1233227,tt0450232,tt1568338,tt1204975,tt1815862,tt1000774,tt1862079,tt0481536,tt12844910,tt0990407,tt4438848,tt1132626,tt10028196,tt6208148,tt10886166,tt6203702,tt13186306,tt12996154,tt0118688,tt0157262,tt1073498,tt26533869,tt8366590,tt0795461,tt31456973,tt1530509,tt6479178,tt1098327,tt0368226,tt21106646,tt9104736,tt1666186,tt20258920,tt9603060,tt1572311,tt0799949,tt0220506,tt19623240,tt5697572,tt30956852,tt0109770,tt11012066,tt1255919,tt1213644,tt4877122,tt0119707,tt0938283,tt27714840,tt0785077,tt0424774,tt1883367,tt29252358,tt0329028,tt6988116,tt0362165,tt1153706,tt0327554,tt2467046,tt0822833,tt0076009,tt4667094,tt0190374,tt1411664,tt5690360,tt0432291,tt0450345,tt0158622,tt0115624,tt0110978,tt31122323,tt1714203,tt0810913,tt0120185,tt0466342,tt7897330,tt0369226,tt6513656,tt10481868,tt4058836,tt7959500,tt3138104,tt0094074,tt1830786,tt0116756,tt0383222,tt7588752,tt0093300,tt0811138,tt30007864,tt0291502,tt31712434,tt1231277,tt3832096,tt12915716,tt1273221,tt1185266,tt0275022,tt14174168,tt4029412,tt0806147,tt7608028,tt0180052,tt30743549,tt0083170,tt1517489,tt0080596,tt0086987,tt0492389,tt0185183,tt0410332,tt2292959,tt0095560,tt7312940,tt0300657,tt0246894,tt0118665,tt0829424,tt12528166,tt0299930,tt0052077,tt0460780,tt0365957,tt0317676,tt2403029,tt35518081,tt0085750,tt7059844,tt1852770,tt13788842,tt11348232,tt21391242,tt1139592,tt27162102,tt18072316,tt0105643,tt0165494,tt9820556,tt10888594,tt0295427,tt0059199,tt23556408,tt0089308,tt11762434,tt0065832,tt12335692,tt5431600,tt15331186,tt0093974,tt4685806,tt1523267,tt7668842,tt7286836,tt0897361,tt0094750,tt0093072,tt0058548,tt1316037,tt0120207,tt0887719,tt27682129,tt0093227,tt0077189,tt0110169,tt29454492,tt0118661,tt14656632,tt0080771,tt0415160,tt12598606,tt0110647,tt0339034,tt4262516,tt5617916,tt0064373,tt0106913,tt10279472,tt1352388,tt2610768,tt0804492,tt3894312,tt12311866,tt0829176,tt0118836,tt15837458,tt0060666,tt9365800,tt1552211,tt0106761,tt12830948,tt2136808,tt0891592,tt0092532,tt0103923,tt1716747,tt14121726,tt12163074,tt27047448,tt0462244,tt13265876,tt12636872,tt12483708,tt5737536,tt0364376,tt37836776,tt0295254,tt30422937,tt7431594,tt11697484,tt0308208,tt0400426,tt2226666,tt1718158,tt0073043,tt0094077,tt5013984,tt0093582,tt6593054,tt1594972,tt7133754,tt3093522,tt7886848,tt3053228,tt0108187,tt11656172,tt25869142,tt0085183,tt0087700,tt2268433,tt0411806,tt3598222,tt4227282,tt8610036,tt0098156,tt8809652,tt0052846,tt0054768,tt0053611,tt0044406,tt0119203,tt6215044,tt0376717,tt0768222,tt1091617,tt14849038,tt3350996,tt0110857,tt9196192,tt1223922,tt5656994,tt15334030,tt0096870,tt7510346,tt16496386,tt1918886,tt1522846,tt0086325,tt1009017,tt9624766,tt0119576,tt11161374,tt14265992,tt0283054,tt0201844,tt0249516,tt0065904,tt1107812,tt0094824,tt23063732,tt4435072,tt0327643,tt2574698,tt4009460,tt0804452,tt0103927,tt0082910,tt6439558,tt0101615,tt3016748,tt7286966,tt4940336,tt7255568,tt0104837,tt0094118,tt2041331,tt22805590,tt3399484,tt0270846,tt7976208,tt35295730,tt18939362,tt0101264,tt20258220,tt9495690,tt2609218,tt4675030,tt2980152,tt15670222,tt7541720,tt3679040,tt8328716,tt6170506,tt7721946,tt0049092,tt13259610,tt26258488,tt14577300,tt5717194,tt0084316,tt3558642,tt27747488,tt13432484,tt15262370,tt6469960,tt1702009,tt21435436,tt10047958,tt27458291,tt0051993,tt0372873,tt13694706,tt0367677,tt14412366,tt8066940,tt6117702,tt0490196,tt5235880,tt9248934,tt4141368,tt0758781,tt0120389,tt3588588,tt3398252,tt0118539,tt0054240,tt7295450,tt8363392,tt17595094,tt0763304,tt0118589,tt0106521,tt0353324,tt1659216,tt18394428,tt1684555,tt1651323,tt2313189,tt8983220,tt11591424,tt12519802,tt12861508,tt10350922,tt0028346,tt0090771,tt1229827,tt0405977,tt0489244,tt6710826,tt13334578,tt0421051,tt1045655,tt1702443,tt2576450,tt13904644,tt0053337,tt11696276,tt1764366,tt0218619,tt14315500,tt0086486";
        const string OutPath = ".\\movie-list.json";

        public static async Task Main(string[] args)
        {
            string[] ids = RawIds.Split(',');

            HttpClient client = new HttpClient()
            {
                BaseAddress = new Uri("http://www.omdbapi.com"),
            };

            int currentIndex = 0;
            List<RawMovie> movieList = new List<RawMovie>();
            try
            {
                for (int i = 0; i < ids.Length; i++)
                {
                    currentIndex = i;
                    string id = ids[i];
                    var request = new HttpRequestMessage(HttpMethod.Get, new Uri($"?i={id}&apiKey={Constants.ApiKey}", UriKind.Relative));
                    var response = await client.SendAsync(request);
                    response.EnsureSuccessStatusCode();

                    var json = await response.Content.ReadAsStringAsync();
                    RawMovie movie = JsonSerializer.Deserialize<RawMovie>(json) ?? throw new Exception("Failed to deserialize to RawMovie");
                    movieList.Add(movie);

                    Console.WriteLine(movie.Title);

                    await Task.Delay(500);
                }
            }
            catch
            {
                Console.WriteLine($"Failed at index {currentIndex}");
                Console.WriteLine("Remaining ids:");
                Console.WriteLine(string.Join(",", ids.Skip(currentIndex)));
            }

            RawMovieList rawMovieList = new RawMovieList() { MovieDatabase = movieList };
            await File.WriteAllTextAsync(Path.GetFullPath(OutPath), JsonSerializer.Serialize(rawMovieList, new JsonSerializerOptions() { WriteIndented = true }));

            Console.WriteLine($"Done. Wrote {rawMovieList.MovieDatabase.Count} movies to {Path.GetFullPath(OutPath)}");
        }
    }
}
